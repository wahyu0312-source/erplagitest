<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ERP System</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Icons + fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body class="theme-light">
  <!-- Topbar (disembunyikan saat belum login) -->
  <header id="topBar" class="topbar hidden">
    <div class="left">
      <div class="brand">ERP System</div>
      <nav class="nav">
        <button id="btnToDash" class="navbtn">Dashboard</button>
        <button id="btnToSales" class="navbtn">Sales</button>
        <button id="btnToPlan" class="navbtn">Plans</button>
        <button id="btnToShip" class="navbtn">Shipments</button>
        <button id="btnToFinPage" class="navbtn">Finished</button>
        <button id="btnToInvPage" class="navbtn">Inventory</button>
        <button id="btnToInvoice" class="navbtn">Invoice</button>
        <button id="btnToAnalytics" class="navbtn">Analytics</button>
      </nav>
    </div>
    <div class="right">
      <span id="userInfo" class="muted"></span>
      <button id="btnLogout" class="btn ghost"><i class="fa-solid fa-right-from-bracket"></i> ログアウト</button>
    </div>
  </header>

  <!-- Auth -->
  <main id="authView" class="center-wrap">
    <section class="card auth">
      <h3><i class="fa-solid fa-right-to-bracket"></i> ログイン</h3>
      <label>ユーザー名</label>
      <input id="inUser" placeholder="admin" />
      <label>パスワード</label>
      <input id="inPass" type="password" placeholder="••••" />
      <button id="btnLogin" class="btn primary">ログイン</button>
      <p class="hint">※ ログイン後にメニューが表示されます。</p>
      <div id="apiWarn" class="warn hidden"></div>
    </section>
  </main>

  <!-- Dashboard -->
  <section id="pageDash" class="page hidden">
    <div class="page-head">
      <h2>Dashboard</h2>
      <div class="tools">
        <input id="searchQ" class="search" placeholder="Search…" />
        <button id="btnExportOrders" class="btn ghost"><i class="fa-regular fa-file-excel"></i> Export</button>
      </div>
    </div>
    <div class="grid grid-2">
      <div class="card">
        <table class="gridtable">
          <thead>
            <tr>
              <th>PO/顧客</th><th>品名</th><th>品番</th><th>図番</th>
              <th>状態</th><th>工程</th><th>更新</th><th>更新者</th><th>操作</th>
            </tr>
          </thead>
          <tbody id="tbOrders"></tbody>
        </table>
      </div>
      <div class="card">
        <h4 class="muted">進捗サマリ</h4>
        <canvas id="chartDash" height="220"></canvas>
      </div>
    </div>
  </section>

  <!-- Sales -->
  <section id="pageSales" class="page hidden">
    <div class="page-head"><h2>Sales Orders</h2>
      <div class="tools">
        <input id="salesSearch" class="search" placeholder="Filter…" />
        <button id="btnSalesExport" class="btn ghost"><i class="fa-regular fa-file-excel"></i></button>
      </div>
    </div>
    <div class="card"><table class="gridtable"><thead id="thSales"></thead><tbody id="tbSales"></tbody></table></div>
  </section>

  <!-- Plans -->
  <section id="pagePlan" class="page hidden">
    <div class="page-head"><h2>Production Plans</h2>
      <div class="tools">
        <input id="planSearch" class="search" placeholder="Filter…" />
        <button id="btnPlanExport" class="btn ghost"><i class="fa-regular fa-file-excel"></i></button>
      </div>
    </div>
    <div class="card"><table class="gridtable"><thead id="thPlan"></thead><tbody id="tbPlan"></tbody></table></div>
  </section>

  <!-- Shipments -->
  <section id="pageShip" class="page hidden">
    <div class="page-head"><h2>Shipments</h2>
      <div class="tools">
        <input id="shipSearch" class="search" placeholder="Filter…" />
        <button id="btnShipExport" class="btn ghost"><i class="fa-regular fa-file-excel"></i></button>
      </div>
    </div>
    <div class="card"><table class="gridtable"><thead id="thShip"></thead><tbody id="tbShip"></tbody></table></div>
  </section>

  <!-- Finished -->
  <section id="pageFinished" class="page hidden">
    <div class="page-head"><h2>Finished Goods</h2>
      <div class="tools">
        <input id="finSearch" class="search" placeholder="Filter…" />
        <button id="btnFinExport" class="btn ghost"><i class="fa-regular fa-file-excel"></i></button>
      </div>
    </div>
    <div class="card"><table class="gridtable"><thead id="thFin"></thead><tbody id="tbFin"></tbody></table></div>
  </section>

  <!-- Inventory -->
  <section id="pageInv" class="page hidden">
    <div class="page-head"><h2>Inventory</h2>
      <div class="tools">
        <input id="invSearch" class="search" placeholder="Filter…" />
        <button id="btnInvExport" class="btn ghost"><i class="fa-regular fa-file-excel"></i></button>
      </div>
    </div>
    <div class="card"><table class="gridtable"><thead id="thInv"></thead><tbody id="tbInv"></tbody></table></div>
  </section>

  <!-- Invoice -->
  <section id="pageInvoice" class="page hidden">
    <div class="page-head">
      <h2>Invoice</h2>
      <div class="tools">
        <select id="invoiceCustomer" class="select"></select>
        <input id="invoiceDate" type="date" class="input" />
        <button id="btnInvoiceReload" class="btn ghost"><i class="fa-solid fa-rotate-right"></i></button>
        <button id="btnInvoiceXlsx" class="btn ghost"><i class="fa-regular fa-file-excel"></i></button>
        <button id="btnInvoicePdf" class="btn ghost"><i class="fa-regular fa-file-pdf"></i></button>
        <button id="btnInvoiceSave" class="btn primary"><i class="fa-regular fa-circle-check"></i> Create</button>
      </div>
    </div>
    <div class="grid grid-2">
      <div class="card">
        <h4 class="muted">候補（未請求）</h4>
        <table class="gridtable">
          <thead><tr><th></th><th>注番</th><th>商品名</th><th>品番</th><th>数量</th><th>単価</th><th>金額</th><th>出荷日</th></tr></thead>
          <tbody id="tbInvoiceCandidates"></tbody>
        </table>
      </div>
      <div class="card">
        <h4 class="muted">出荷履歴・請求状態</h4>
        <table class="gridtable">
          <thead><tr><th>注番</th><th>商品名</th><th>品番</th><th>数量</th><th>単価</th><th>金額</th><th>出荷日</th><th>状態</th></tr></thead>
          <tbody id="tbInvoiceStatus"></tbody>
        </table>
        <h4 class="muted mt">請求書一覧</h4>
        <table class="gridtable">
          <thead><tr><th>ID</th><th>得意先</th><th>発行日</th><th>合計</th><th>ファイル名</th><th>作成者</th></tr></thead>
          <tbody id="tbInvoiceList"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Analytics (placeholder) -->
  <section id="pageAnalytics" class="page hidden">
    <div class="page-head"><h2>Analytics</h2></div>
    <div class="card"><p class="muted">Add KPIs/Charts here…</p></div>
  </section>

  <!-- Dialog: Operation -->
  <dialog id="dlgOp" class="dialog">
    <h3>作業入力 <span id="opPO" class="muted"></span></h3>
    <div class="grid grid-2">
      <label>工程<select id="opProcess"></select></label>
      <label>OK<input id="opOK" type="number" min="0" value="0"></label>
      <label>NG<input id="opNG" type="number" min="0" value="0"></label>
      <label>備考<input id="opNote" placeholder="note…"></label>
    </div>
    <div class="actions">
      <button id="btnOpCancel" class="btn ghost">キャンセル</button>
      <button id="btnOpSave" class="btn primary">保存</button>
    </div>
  </dialog>

  <!-- Dialog: QR Scan -->
  <dialog id="dlgScan" class="dialog">
    <h3><i class="fa-solid fa-qrcode"></i> スキャン</h3>
    <video id="scanVideo" playsinline></video>
    <canvas id="scanCanvas" class="hidden"></canvas>
    <div class="muted s">Result: <span id="scanResult">—</span></div>
    <div class="actions">
      <button id="btnScanClose" class="btn ghost">閉じる</button>
      <button id="btnScanStart" class="btn primary">開始</button>
    </div>
  </dialog>

  <!-- Libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.20.0/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

  <!-- App -->
  <script src="app.js"></script>
</body>
</html>
